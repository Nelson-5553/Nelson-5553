---
import { getRelativeLocaleUrl } from 'astro:i18n';
import ClientRouter from 'astro/components/ClientRouter.astro';

interface Props {
  title: string;
  class?: string;
  lang: string;
}

const { title, lang = "es" } = Astro.props;

// Importar navegaciones según el idioma
import NavEs from '@components/es/nav.astro';
import NavEn from '@components/en/nav.astro';
const Nav = lang === "en" ? NavEn : NavEs;

// Obtener la ruta actual sin el prefijo de idioma
const currentPath = Astro.url.pathname.replace(/^\/(es|en)/, '') || '/';

// Generar URLs para cambio de idioma
const esUrl = getRelativeLocaleUrl('es', currentPath);
const enUrl = getRelativeLocaleUrl('en', currentPath);
---

<!doctype html>
<html lang={lang} class="overflow-x-hidden">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Astro description" />
    <meta name="viewport" content="width=device-width" />
    <link class="rounded-full" rel="icon" href="/img/N5553.png" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    
    <!-- Scripts externos -->
    <script src="../js/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />

    <ClientRouter />
    
    <!-- Script del tema -->
    <script is:inline>
      function applyTheme() {
        const rootElement = document.documentElement;
        const currentTheme = localStorage.getItem('theme');

        if (!currentTheme) {
          rootElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        } else if (currentTheme === 'dark') {
          rootElement.classList.add('dark');
        } else {
          rootElement.classList.remove('dark');
        }

        updateThemeIcon();
      }

      function updateThemeIcon() {
        const toggleButton = document.getElementById('theme-toggle');
        const isDarkMode = document.documentElement.classList.contains('dark');

        if (toggleButton) {
          const sunIcon = toggleButton.querySelector('svg:nth-child(1)');
          const moonIcon = toggleButton.querySelector('svg:nth-child(2)');

          if (isDarkMode) {
            sunIcon.style.display = 'block';
            moonIcon.style.display = 'none';
          } else {
            sunIcon.style.display = 'none';
            moonIcon.style.display = 'block';
          }
        }
      }

      function setupThemeToggle() {
        const toggleButton = document.getElementById('theme-toggle');
        const rootElement = document.documentElement;

        if (toggleButton) {
          toggleButton.addEventListener('click', () => {
            if (rootElement.classList.contains('dark')) {
              rootElement.classList.remove('dark');
              localStorage.setItem('theme', 'light');
            } else {
              rootElement.classList.add('dark');
              localStorage.setItem('theme', 'dark');
            }
            updateThemeIcon();
          });
        }
      }

      // Configuración inicial del tema
      applyTheme();
      setupThemeToggle();

      // Manejar persistencia del tema durante transiciones
      document.addEventListener('astro:page-load', () => {
        applyTheme();
        setupThemeToggle();
      });
    </script>

    <!-- Script para el cambio de idioma -->
       <script is:inline define:vars={{ esUrl, enUrl, lang }}>
      function setupLanguageSelector() {
        const languageSelect = document.getElementById('language-select');
        
        if (languageSelect) {
          languageSelect.addEventListener('change', (e) => {
            const selectedLang = e.target.value;
            
            console.log('Changing language to:', selectedLang);
            console.log('Current lang:', lang);
            console.log('ES URL:', esUrl);
            console.log('EN URL:', enUrl);
            
            if (selectedLang === 'es') {
              window.location.href = esUrl;
            } else if (selectedLang === 'en') {
              window.location.href = enUrl;
            }
          });
        }
      }

      // Configurar selector al cargar la página
      document.addEventListener('DOMContentLoaded', setupLanguageSelector);
      
      // Reconfigurar en transiciones de Astro
      document.addEventListener('astro:page-load', setupLanguageSelector);
    </script>
  </head>
  
  <body class="bg-white dark:bg-neutral-950 h-screen w-screen bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(120,119,198,0.3),rgba(255,255,255,0))] bg-fixed min-h-screen transition-colors">
    <div class="absolute inset-0 -z-10 h-full w-full"></div>
    
    <main class="relative flex justify-center min-h-screen px-16">
      <div class="absolute top-4 right-8 flex items-center space-x-4">
        <!-- Botón para cambio de tema -->
        <button
          id="theme-toggle"
          class="p-2 rounded-lg bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors"
          aria-label="Toggle theme"
        >
          <!-- Icono del sol (mostrado en modo oscuro) -->
          <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
          </svg>
          <!-- Icono de la luna (mostrado en modo claro) -->
          <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
          </svg>
        </button>
        <!-- Selector de idioma mejorado -->
        <div class="flex items-center space-x-2">
          <label for="language-select" class="sr-only">
        {lang === 'es' ? 'Seleccionar idioma' : 'Select language'}
          </label>
          <select
        id="language-select"
        class="border border-gray-300 dark:border-gray-700 rounded-md px-3 py-2 text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
        <option value="es">🇪🇸 Español</option>
        <option value="en">🇺🇸 English</option>
          </select>
        </div>
      </div>
      
      <div class="flex flex-col justify-start items-start mt-32 min-h-screen max-w-7xl prose dark:prose-invert">
        <div class="w-full">
          <!-- Header con navegación y selector de idioma -->
          <header class="flex items-center justify-between mb-8 not-prose">
            <Nav lang={lang} />
            
          </header>
          
          <!-- Contenido de la página -->
          <slot />
        </div>
      </div>
    </main>
  </body>
</html>